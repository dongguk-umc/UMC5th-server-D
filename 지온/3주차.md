### 양방향 매핑

- 반대 방향으로의 객체 그래프 탐색 허용(가급적 단방향이 좋긴 함)

### 객체와 테이블이 관계를 맺는 차이

- 객체 연관관계 = 2개
    - 회원 → 팀 연관관계 1개(단방향)
    - 팀 → 회원 연관관계 1개(단방향)
- 테이블 연관관계 = 1개
    - 회원 ↔ 팀의 연관관계 1개(양방향)
    - 사실상 방향이 없음

### 객체의 양방향 관계

- 객체의 양방향 관계는 사실 양방향 관계가 아니라 서로 다른 단방향 관계 2개임
- 객체의 양방향을 참조하려면 단방향 연관관계를 2개 만들어야 함

### 테이블의 양방향 연관관계

- 테이블은 외래 키 하나로 두 테이블의 연관관계를 관리
- MEMBER.TEAM_ID 외래 키 하나로 양방향 연관관계 가짐
    - 양쪽에서 조인 가능

### 연관관계의 주인(Owner)

- 객체의 두 관계 중 하나를 연관관계의 주인으로 지정
- 연관관계의 주인만이 외래 키를 관리(등록, 수정)
- 주인이 아닌쪽은 읽기만 가능
- 주인은 mappedBy 속성 사용x
- 주인이 아니면 mappedBy 속성으로 주인 지정

### 양방향 매핑 시 가장 많이 하는 실수

- 연관관계의 주인에 값을 입력하지 않음
- 순수한 객체 관계를 고려하면 항상 양쪽 다 값을 입력해야 함

### 양방향 매핑 정리

- 단방향 매핑만으로도 이미 연관관계 매핑은 완료
    - 설계는 단방향만으로 완성, 이후 개발시 양방향이 필요하다면 추가하는 형태로 진행
    - 객체 입장에서 양방향이라는 건 양쪽으로 신경써야 해서 복잡성이 늘어남
- 양방향 매핑은 반대 방향으로의 조회 기능이 추가된 것
    - JPQL에서 역방향으로 탐색할 일이 많음

### 양방향 연관관계 주의 - 실습

- 순수 객체 상태를 고려해서 항상 양쪽에 값을 설정하자
    - 연관관계 편의 메소드를 생성하자
    - 한쪽의 누락을 방지하기 위해 @Entity 클래스의 메서드에 구현하여 원자성을 확보
- 양방향 매핑시에 무한 루프를 조심하자
    - ex) toString(), lombok, JSON 생성 라이브러리

### :seedling: 궁금증 정리

단방향 매핑과 양방향 매핑의 성능 차이?
- :mag: 기본적으로, 단방향과 양방향 매핑 사이의 쿼리 호출로 인한 성능 차이는 거의 없다. 특정 엔티티를 조회하기 위한 SQL은 단방향과 양방향이 동일하다.
단방향 매핑에서 역방향 조회를 원하면, 별도의 쿼리를 실행해야 한다. 하지만, 양방향 매핑에서도 연관된 엔티티를 조회하려면, **`LAZY`** 로딩 전략을 사용할 경우 해당 엔티티에 접근할 때 추가 쿼리가 실행된다.
양방향이라고 항상 쿼리를 덜 쓰는 것은 아니기에 단방향과 양방향의 성능은 기본적으로 동일하다고 본다.
